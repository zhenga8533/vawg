var G="data-focus-lock",fr="data-focus-lock-disabled",cr="data-no-focus-lock",vr="data-autofocus-inside",dr="data-no-autofocus",b=function(r){for(var n=Array(r.length),e=0;e<r.length;++e)n[e]=r[e];return n},O=function(r){return Array.isArray(r)?r:[r]},J=function(r){return Array.isArray(r)?r[0]:r},lr=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var n=window.getComputedStyle(r,null);return!n||!n.getPropertyValue?!1:n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"},Q=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},X=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},sr=function(r){return r.hasAttribute("inert")},br=function(r,n){return!r||X(r)||!lr(r)&&!sr(r)&&n(Q(r))},Z=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=br(n,Z.bind(void 0,r));return r.set(n,t),t},mr=function(r,n){return r&&!X(r)?xr(r)?n(Q(r)):!1:!0},$=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=mr(n,$.bind(void 0,r));return r.set(n,t),t},rr=function(r){return r.dataset},hr=function(r){return r.tagName==="BUTTON"},nr=function(r){return r.tagName==="INPUT"},er=function(r){return nr(r)&&r.type==="radio"},gr=function(r){return!((nr(r)||hr(r))&&(r.type==="hidden"||r.disabled))},xr=function(r){var n=r.getAttribute(dr);return![!0,"true",""].includes(n)},P=function(r){var n;return!!(r&&(!((n=rr(r))===null||n===void 0)&&n.focusGuard))},M=function(r){return!P(r)},Or=function(r){return!!r},yr=function(r,n){var e=Math.max(0,r.tabIndex),t=Math.max(0,n.tabIndex),u=e-t,a=r.index-n.index;if(u){if(!e)return 1;if(!t)return-1}return u||a},pr=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},k=function(r,n,e){return b(r).map(function(t,u){var a=pr(t);return{node:t,index:u,tabIndex:e&&a===-1?(t.dataset||{}).focusGuard?0:-1:a}}).filter(function(t){return!n||t.tabIndex>=0}).sort(yr)},Fr=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],U=Fr.join(","),Ir="".concat(U,", [data-focus-guard]"),tr=function(r,n){return b((r.shadowRoot||r).children).reduce(function(e,t){return e.concat(t.matches(n?Ir:U)?[t]:[],tr(t))},[])},Ar=function(r,n){var e;return r instanceof HTMLIFrameElement&&(!((e=r.contentDocument)===null||e===void 0)&&e.body)?p([r.contentDocument.body],n):[r]},p=function(r,n){return r.reduce(function(e,t){var u,a=tr(t,n),o=(u=[]).concat.apply(u,a.map(function(c){return Ar(c,n)}));return e.concat(o,t.parentNode?b(t.parentNode.querySelectorAll(U)).filter(function(c){return c===t}):[])},[])},wr=function(r){var n=r.querySelectorAll("[".concat(vr,"]"));return b(n).map(function(e){return p([e])}).reduce(function(e,t){return e.concat(t)},[])},_=function(r,n){return b(r).filter(function(e){return Z(n,e)}).filter(function(e){return gr(e)})},V=function(r,n){return n===void 0&&(n=new Map),b(r).filter(function(e){return $(n,e)})},R=function(r,n,e){return k(_(p(r,e),n),!0,e)},w=function(r,n){return k(_(p(r),n),!1)},Er=function(r,n){return _(wr(r),n)},x=function(r,n){return r.shadowRoot?x(r.shadowRoot,n):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,n)?!0:b(r.children).some(function(e){var t;if(e instanceof HTMLIFrameElement){var u=(t=e.contentDocument)===null||t===void 0?void 0:t.body;return u?x(u,n):!1}return x(e,n)})},Tr=function(r){for(var n=new Set,e=r.length,t=0;t<e;t+=1)for(var u=t+1;u<e;u+=1){var a=r[t].compareDocumentPosition(r[u]);(a&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&n.add(u),(a&Node.DOCUMENT_POSITION_CONTAINS)>0&&n.add(t)}return r.filter(function(o,c){return!n.has(c)})},ur=function(r){return r.parentNode?ur(r.parentNode):r},W=function(r){var n=O(r);return n.filter(Boolean).reduce(function(e,t){var u=t.getAttribute(G);return e.push.apply(e,u?Tr(b(ur(t).querySelectorAll("[".concat(G,'="').concat(u,'"]:not([').concat(fr,'="disabled"])')))):[t]),e},[])},Nr=function(r){try{return r()}catch{return}},A=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var n=r.activeElement;return n.shadowRoot?A(n.shadowRoot):n instanceof HTMLIFrameElement&&Nr(function(){return n.contentWindow.document})?A(n.contentWindow.document):n}},Sr=function(r,n){return r===n},Mr=function(r,n){return!!b(r.querySelectorAll("iframe")).some(function(e){return Sr(e,n)})},qr=function(r,n){return n===void 0&&(n=A(J(r).ownerDocument)),!n||n.dataset&&n.dataset.focusGuard?!1:W(r).some(function(e){return x(e,n)||Mr(e,n)})},Gr=function(r){r===void 0&&(r=document);var n=A(r);return n?b(r.querySelectorAll("[".concat(cr,"]"))).some(function(e){return x(e,n)}):!1},Dr=function(r,n){return n.filter(er).filter(function(e){return e.name===r.name}).filter(function(e){return e.checked})[0]||r},B=function(r,n){return er(r)&&r.name?Dr(r,n):r},Cr=function(r){var n=new Set;return r.forEach(function(e){return n.add(B(e,r))}),r.filter(function(e){return n.has(e)})},j=function(r){return r[0]&&r.length>1?B(r[0],r):r[0]},K=function(r,n){return r.indexOf(B(n,r))},D="NEW_FOCUS",Pr=function(r,n,e,t,u){var a=r.length,o=r[0],c=r[a-1],m=P(t);if(!(t&&r.indexOf(t)>=0)){var i=t!==void 0?e.indexOf(t):-1,g=u?e.indexOf(u):i,f=u?r.indexOf(u):-1;if(i===-1)return f!==-1?f:D;if(f===-1)return D;var v=i-g,s=e.indexOf(o),l=e.indexOf(c),d=Cr(e),E=t!==void 0?d.indexOf(t):-1,F=E-(u?d.indexOf(u):i);if(!v&&f>=0||n.length===0)return f;var h=K(r,n[0]),y=K(r,n[n.length-1]);if(i<=s&&m&&Math.abs(v)>1)return y;if(i>=l&&m&&Math.abs(v)>1)return h;if(v&&Math.abs(F)>1)return f;if(i<=s)return y;if(i>l)return h;if(v)return Math.abs(v)>1?f:(a+f+v)%a}},kr=function(r){return function(n){var e,t=(e=rr(n))===null||e===void 0?void 0:e.autofocus;return n.autofocus||t!==void 0&&t!=="false"||r.indexOf(n)>=0}},Y=function(r,n,e){var t=r.map(function(a){var o=a.node;return o}),u=V(t.filter(kr(e)));return u&&u.length?j(u):j(V(n))},C=function(r,n){return n===void 0&&(n=[]),n.push(r),r.parentNode&&C(r.parentNode.host||r.parentNode,n),n},T=function(r,n){for(var e=C(r),t=C(n),u=0;u<e.length;u+=1){var a=e[u];if(t.indexOf(a)>=0)return a}return!1},ar=function(r,n,e){var t=O(r),u=O(n),a=t[0],o=!1;return u.filter(Boolean).forEach(function(c){o=T(o||c,c)||o,e.filter(Boolean).forEach(function(m){var i=T(a,m);i&&(!o||x(i,o)?o=i:o=T(i,o))})}),o},z=function(r,n){return r.reduce(function(e,t){return e.concat(Er(t,n))},[])},Ur=function(r,n){var e=new Map;return n.forEach(function(t){return e.set(t.node,t)}),r.map(function(t){return e.get(t)}).filter(Or)},_r=function(r,n){var e=A(O(r).length>0?document:J(r).ownerDocument),t=W(r).filter(M),u=ar(e||r,r,t),a=new Map,o=w(t,a),c=o.filter(function(l){var d=l.node;return M(d)});if(c[0]){var m=w([u],a).map(function(l){var d=l.node;return d}),i=Ur(m,c),g=i.map(function(l){var d=l.node;return d}),f=i.filter(function(l){var d=l.tabIndex;return d>=0}).map(function(l){var d=l.node;return d}),v=Pr(g,f,m,e,n);if(v===D){var s=Y(o,f,z(t,a))||Y(o,g,z(t,a));if(s)return{node:s};console.warn("focus-lock: cannot find any node to move focus into");return}return v===void 0?v:i[v]}},Vr=function(r){var n=W(r).filter(M),e=ar(r,r,n),t=k(p([e],!0),!0,!0),u=p(n,!1);return t.map(function(a){var o=a.node,c=a.index;return{node:o,index:c,lockItem:u.indexOf(o)>=0,guard:P(o)}})},L=function(r,n){r&&("focus"in r&&r.focus(n),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},N=0,S=!1,jr=function(r,n,e){e===void 0&&(e={});var t=_r(r,n);if(!S&&t){if(N>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),S=!0,setTimeout(function(){S=!1},1);return}N++,L(t.node,e.focusOptions),N--}};function I(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var n=r?new WeakRef(r):null;return function(){return(n==null?void 0:n.deref())||null}}var Rr=function(r){if(!r)return null;for(var n=[],e=r;e&&e!==document.body;)n.push({current:I(e),parent:I(e.parentElement),left:I(e.previousElementSibling),right:I(e.nextElementSibling)}),e=e.parentElement;return{element:I(r),stack:n,ownerDocument:r.ownerDocument}},Wr=function(r){var n,e,t,u,a;if(r)for(var o=r.stack,c=r.ownerDocument,m=new Map,i=0,g=o;i<g.length;i++){var f=g[i],v=(n=f.parent)===null||n===void 0?void 0:n.call(f);if(v&&c.contains(v)){for(var s=(e=f.left)===null||e===void 0?void 0:e.call(f),l=f.current(),d=v.contains(l)?l:void 0,E=(t=f.right)===null||t===void 0?void 0:t.call(f),F=R([v],m),h=(a=(u=d??(s==null?void 0:s.nextElementSibling))!==null&&u!==void 0?u:E)!==null&&a!==void 0?a:s;h;){for(var y=0,H=F;y<H.length;y++){var q=H[y];if(h!=null&&h.contains(q.node))return q.node}h=h.nextElementSibling}if(F.length)return F[0].node}}},Kr=function(r){var n=Rr(r);return function(){return Wr(n)}},Br=function(r,n,e){if(!r||!n)return console.error("no element or scope given"),{};var t=O(n);if(t.every(function(o){return!x(o,r)}))return console.error("Active element is not contained in the scope"),{};var u=e?R(t,new Map):w(t,new Map),a=u.findIndex(function(o){var c=o.node;return c===r});if(a!==-1)return{prev:u[a-1],next:u[a+1],first:u[0],last:u[u.length-1]}},Lr=function(r,n){var e=n?R(O(r),new Map):w(O(r),new Map);return{first:e[0],last:e[e.length-1]}},Hr=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},or=function(r,n,e){n===void 0&&(n={});var t=Hr(n),u=Br(r,t.scope,t.onlyTabbable);if(u){var a=e(u,t.cycle);a&&L(a.node,t.focusOptions)}},Yr=function(r,n){n===void 0&&(n={}),or(r,n,function(e,t){var u=e.next,a=e.first;return u||t&&a})},zr=function(r,n){n===void 0&&(n={}),or(r,n,function(e,t){var u=e.prev,a=e.last;return u||t&&a})},ir=function(r,n,e){var t,u=Lr(r,(t=n.onlyTabbable)!==null&&t!==void 0?t:!0),a=u[e];a&&L(a.node,n.focusOptions)},Jr=function(r,n){n===void 0&&(n={}),ir(r,n,"first")},Qr=function(r,n){n===void 0&&(n={}),ir(r,n,"last")};export{fr as F,G as a,Yr as b,zr as c,Jr as d,Qr as e,qr as f,Kr as g,Vr as h,Gr as i,jr as m};
